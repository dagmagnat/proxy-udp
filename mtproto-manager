изменить_порт() {
  conf_load
  [[ -f "$CONF" && -n "$CONF_KEY" ]] || { echo "Сначала создайте прокси (пункт 1)." >&2; return 1; }

  local newport
  while true; do
    echo
    echo "Текущий порт: ${CONF_PORT:-не задан}"
    read -r -p "Введите новый порт (1-65535, кроме 80/443): " newport
    newport="$(trim "$newport")"

    if ! valid_port "$newport"; then
      echo "Неверный порт: '$newport'"
      continue
    fi

    if ! port_free "$newport"; then
      echo "Порт $newport занят. Выберите другой."
      continue
    fi

    break
  done

  conf_save "$newport" "$CONF_KEY"
  echo
  echo "Порт сохранён: $newport"
  echo "Чтобы применить — сделайте перезапуск (пункт 3)."
  показать_ссылку
}
